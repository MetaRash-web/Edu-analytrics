<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- –ü–ª–∞–≥–∏–Ω –ª–µ–≥–µ–Ω–¥—ã (cdnjs, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartist-plugin-legend/0.6.2/chartist-plugin-legend.min.js"></script>

    <!-- –ü–ª–∞–≥–∏–Ω tooltip (cdnjs, –≤–µ—Ä—Å–∏—è 0.0.11 ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartist-plugin-tooltip/0.0.11/chartist-plugin-tooltip.min.js"></script>    <!-- Bootstrap + Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Chartist -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/charts.css">
    <link rel="stylesheet" href="/css/components.css">

    <!-- JS -->
    <script src="/js/utils.js"></script>
    <script src="/js/charts.js"></script>
    <script src="/js/dashboard.js"></script>
</head>
<body>

<!-- –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –•–ï–î–ï–† -->
<header class="dashboard-header">
    <div class="container-fluid d-flex align-items-center justify-content-between px-4 py-3">
        <div class="header-brand">
            <h2 class="brand-title">üìä Analytics Dashboard</h2>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-light btn-sm" onclick="dashboard.exportData('json')">
                <i class="bi bi-file-earmark-code"></i> JSON
            </button>
            <button class="btn btn-light btn-sm" onclick="dashboard.exportData('csv')">
                <i class="bi bi-file-earmark"></i> CSV
            </button>
        </div>
    </div>
</header>

<!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
<main class="main-content">
    <div class="decor-1"></div>
    <div class="decor-2"></div>
    <div class="decor-3"></div>
    <div class="decor-4"></div>
    <div class="decor-5"></div>
    <main class="main-content">
        <div class="container-fluid py-4">
            <div class="row g-4">
                <!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä (—à—É–º: –≤–∏–¥–∂–µ—Ç—ã) -->
                <div class="col-lg-2 d-none d-lg-block sidebar-left">
                    <div class="sidebar-card mb-4">
                        <h5 class="mb-3">Recent Activity</h5>
                        <ul class="list-unstyled">
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-person-plus me-2 text-primary"></i>
                                <span>–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</span>
                            </li>
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-cart-check me-2 text-success"></i>
                                <span>–ó–∞–∫–∞–∑ #1234 –æ–ø–ª–∞—á–µ–Ω</span>
                            </li>
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-graph-up me-2 text-info"></i>
                                <span>Retention –≤—ã—Ä–æ—Å –Ω–∞ 5%</span>
                            </li>
                            <!-- –î–æ–±–∞–≤—å 3-5 —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã -->
                        </ul>
                    </div>
                    <div class="sidebar-card">
                        <h5 class="mb-3">–¢–æ–ø –º–µ—Ç—Ä–∏–∫–∏</h5>
                        <ul class="list-unstyled">
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-people-fill me-3 text-primary fs-4"></i>
                                <div>
                                    <span class="d-block fw-medium">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                                    <small class="text-muted">1,245 (–Ω–∞ 5% –≤—ã—à–µ)</small>
                                </div>
                            </li>
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-cart-fill me-3 text-success fs-4"></i>
                                <div>
                                    <span class="d-block fw-medium">–ó–∞–∫–∞–∑—ã –∑–∞ –Ω–µ–¥–µ–ª—é</span>
                                    <small class="text-muted">320 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)</small>
                                </div>
                            </li>
                            <li class="d-flex align-items-center mb-3">
                                <i class="bi bi-graph-up me-3 text-info fs-4"></i>
                                <div>
                                    <span class="d-block fw-medium">–†–æ—Å—Ç –≤—ã—Ä—É—á–∫–∏</span>
                                    <small class="text-muted">+12% –∑–∞ –º–µ—Å—è—Ü</small>
                                </div>
                            </li>
                            <!-- 2-3 –ø—É–Ω–∫—Ç–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã -->
                        </ul>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="col-lg-8">
                    <!-- –¢–≤–æ–π —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç: —Å–µ–ª–µ–∫—Ç, —Å–ø–∏–Ω–Ω–µ—Ä, –º–µ—Ç—Ä–∏–∫–∏, –≥—Ä–∞—Ñ–∏–∫–∏, –ø—Ä–æ–¥—É–∫—Ç—ã -->
                    <!-- –°–µ–ª–µ–∫—Ç –ø–µ—Ä–∏–æ–¥–∞ -->
                    <div class="mb-4">
                        <select id="periodSelect" class="form-select w-auto d-inline-block">
                            <option th:selected="${selectedPeriod == 'last7days'}" value="last7days">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                            <option th:selected="${selectedPeriod == 'last30days'}" value="last30days">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</option>
                            <option th:selected="${selectedPeriod == 'last365days'}" value="last365days">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 365 –¥–Ω–µ–π</option>
                        </select>
                    </div>

                    <!-- –°–ø–∏–Ω–Ω–µ—Ä -->
                    <div id="loadingSpinner" class="text-center mb-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>

                    <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
                    <div class="row metrics-row g-4 mb-5">
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-people-fill metric-icon"></i>
                                <h5>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h5>
                                <p class="metric-value"><span id="userCount" th:text="${userCount}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-book-half metric-icon"></i>
                                <h5>–ö—É—Ä—Å—ã</h5>
                                <p class="metric-value"><span id="courseCount" th:text="${courseCount}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-cart-fill metric-icon"></i>
                                <h5>–ó–∞–∫–∞–∑—ã</h5>
                                <p class="metric-value"><span id="orderCount" th:text="${orderCount}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-currency-ruble metric-icon"></i>
                                <h5>–í—ã—Ä—É—á–∫–∞</h5>
                                <p class="metric-value"><span id="totalRevenue" th:text="${totalRevenue}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-arrow-repeat metric-icon"></i>
                                <h5>Retention Rate</h5>
                                <p class="metric-value"><span id="retentionRate" th:text="${retentionRate}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-graph-up-arrow metric-icon"></i>
                                <h5>LTV</h5>
                                <p class="metric-value"><span id="ltv" th:text="${ltv}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-graph-down-arrow metric-icon"></i>
                                <h5>CAC</h5>
                                <p class="metric-value"><span id="cac" th:text="${cac}">0</span></p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <i class="bi bi-wallet-fill metric-icon"></i>
                                <h5>ARPPU</h5>
                                <p class="metric-value"><span id="arppu" th:text="${arppu}">0</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
                    <div class="row charts-row g-4 mb-5">
                        <div class="col-md-6">
                            <div class="chart-card h-100">
                                <h3 class="mb-3">–ê—É–¥–∏—Ç–æ—Ä–∏—è</h3>
                                <div id="audienceChart" class="ct-chart"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-card h-100">
                                <h3 class="mb-3">Retention Trend</h3>
                                <div id="retentionChart" class="ct-chart"></div>
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–¥—É–∫—Ç—ã -->
                    <h3 class="mb-4">–ü—Ä–æ–¥—É–∫—Ç—ã</h3>
                    <div id="productsGrid" class="row g-4">
                        <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –∏–∑ JS -->
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —à—É–º: tips) -->
                <div class="col-lg-2 d-none d-lg-block sidebar-right">
                    <div class="sidebar-card mb-4">
                        <h5 class="mb-3">–ü–æ–ª–µ–∑–Ω—ã–µ insights</h5>
                        <ul class="list-unstyled small text-muted">
                            <li class="mb-2"><i class="bi bi-lightbulb me-2 text-warning"></i>Retention –≤—ã—à–µ 70% —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç ‚Äî —Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–∏.</li>
                            <li class="mb-2"><i class="bi bi-lightbulb me-2 text-warning"></i>LTV –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ 3 —Ä–∞–∑–∞ –≤—ã—à–µ CAC –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–æ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞.</li>
                            <li class="mb-2"><i class="bi bi-lightbulb me-2 text-warning"></i>–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ ARPPU: —Ä–æ—Å—Ç –Ω–∞ 10% –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –≤—ã—Ä—É—á–∫—É –Ω–∞ 20% –±–µ–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</li>
                            <li class="mb-2"><i class="bi bi-lightbulb me-2 text-warning"></i>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –≤—ã—è–≤–∏—Ç—å –ª–∏–¥–µ—Ä–æ–≤ –ø—Ä–æ–¥–∞–∂.</li>
                            <!-- –î–æ–±–∞–≤—å 2-3 –ø—É–Ω–∫—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ "–≤–æ–¥—ã" -->
                        </ul>
                    </div>
                    <div class="sidebar-card">
                        <h5 class="mb-3">–ù–æ–≤–æ—Å—Ç–∏</h5>
                        <ul class="list-unstyled small text-muted">
                            <li>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Q2.</li>
                            <li>–¢—Ä–µ–Ω–¥: –†–æ—Å—Ç ARPPU –Ω–∞ 15% –≤ –æ—Ç—Ä–∞—Å–ª–∏.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

<!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
<script th:inline="javascript">
    var initialData = {
        dashboardStats: {
            userCount: /*[[${userCount}]]*/ 0,
            courseCount: /*[[${courseCount}]]*/ 0,
            orderCount: /*[[${orderCount}]]*/ 0,
            totalRevenue: /*[[${totalRevenue}]]*/ 0
        },
        audienceMetrics: /*[[${audienceMetrics}]]*/ {},
        retentionRate: /*[[${retentionRate}]]*/ 0,
        ltv: /*[[${ltv}]]*/ 0,
        cac: /*[[${cac}]]*/ 0,
        arppu: /*[[${arppu}]]*/ 0,
        productPerformance: /*[[${productPerformance}]]*/ [],
        retentionTrend: /*[[${retentionTrend}]]*/ {}
    };
    dashboard.init(initialData);
</script>
</main>
</body>
</html>